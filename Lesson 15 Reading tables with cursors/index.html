<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Vojta Barták">
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Lesson 15 Cursors - Python for ArcGIS</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Lesson 15 Cursors";
    var mkdocs_page_input_path = "Lesson 15 Reading tables with cursors.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Python for ArcGIS</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Model Builder</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Lesson%2001%20Model%20Builder%20I/">Lesson 1: Model editting</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Lesson%2002%20Model%20Builder%20II/">Lesson 2: User environment</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Python</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Lesson%2003%20Writing%20and%20running%20Python%20programs/">Lesson 3: Starting python</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../Lesson 04 Variables and data types">Lesson 4: Variables and data types</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Lesson%2005%20Conditions%20and%20Loops/">Lesson 5: Loops and conditions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Lesson%2006%20Interactive%20inputs%20and%20random%20numbers/">Lesson 6: Inputs and random numbers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Lesson%2007%20Directories%20and%20text%20files/">Lesson 7: Directories and text files</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Lesson%2008%20Functions%20and%20modules/">Lesson 8: Functions and modules</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../Lekce 9 Třídy a objekty.md">Lekce 9: Třídy a objekty</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">ArcPy</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../Lesson%2010%20Running%20ArcPy%20tools/">Lesson 10: Running ArcPy tools</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../Lekce 11 Procházení geodat a jejich vlastností pomocí balíčku ArcPy.md">Lekce 11: Procházení a prohlížení geodat</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Lesson%2012%20Tool%20user%20interfaces/">Lesson 12: Tool user interfaces</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Lesson%2013%20Attribute%20Operations/">Lesson 13: Attribute Operations</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Lesson 15 Cursors</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#read-rows-using-the-search-cursor">Read rows using the Search cursor</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#overwrite-values-in-a-row-with-update-cursor">Overwrite values in a row with Update cursor</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#delete-a-row">Delete a row</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#add-a-new-line-with-insert-cursor">Add a new line with Insert cursor</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#old-cursor-types">Old cursor types</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#exercises">Exercises</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="" href="../Lekce 18 Rastrové analýzy.md">Lekce 18: Rastrové analýzy</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../about_me/">About me...</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../tests_upload/">Tests and homeworks</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Python for ArcGIS</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>ArcPy &raquo;</li>
        
      
    
    <li>Lesson 15 Cursors</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/vojta-bartak/Python-for-ArcGIS-CZU-EN/edit/master/docs/Lesson 15 Reading tables with cursors.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="lesson-15-reading-tables-with-cursors">Lesson 15: Reading tables with cursors</h1>
<p>In this lesson, you will learn how to browse attribute tables (or other tables in <code>.dbf</code> format) line by line and read and write values from/to individual fields (columns). We will test individual procedures on <a href="https://owncloud.cesnet.cz/index.php/s/87mECJH9RhNIdVz">data</a> of regions (polygons) and large cities (points) of the Czech Republic.</p>
<blockquote>
<p><strong>Task 1.</strong> Start a new ArcGIS project and view the data, including attribute tables.</p>
</blockquote>
<p>The table is browsed using the so-called <em>cursor</em>, which is an object similar to what we create when opening text files with the <code>open</code> function: it mediates the connection with the given file (table), so it is locked for editing by any other applications as long as we browse it. For this reason, it is necessary to delete the created cursor after finishing work with the table (with the command <code>del</code>), similarly to closing a text file (where we use the <code>close</code> method.</p>
<p>Cursors in <code>arcpy</code> are of three types:</p>
<ul>
<li><strong>Search Cursor</strong> - only for reading values from the table,</li>
<li><strong>Update Cursor</strong> - for reading and writing to existing table rows,</li>
<li><strong>Insert Cursor</strong> - for inserting new rows into the table and deleting existing rows.</li>
</ul>
<h2 id="read-rows-using-the-search-cursor">Read rows using the <em>Search</em> cursor</h2>
<p>The syntax for using a cursor is as follows:</p>
<pre><code class="language-python">tab = arcpy.da.SearchCursor(in_table, field_names, {where_clause}, ...)
</code></pre>
<p>In the given code we store the cursor in the variable <code>tab</code>. The <code>arcpy.da.</code> section refers to the fact that the cursors in the <code>arcpy</code> package are implemented in a separate <code>da</code> module (short for "Data Access"). The cursor object (ie object of the class <em>SearchCursor</em>) is created by the class constructor of the same name (<code>SearchCursor</code> function in the example). The most important parameters of the function are:</p>
<ul>
<li><strong>in_table</strong> - table to be opened (the whole path as a string, or a relative path with respect to the working directory) - it can be a shapefile, feature class, feature layer, <code>.dbf</code> table, or a table view.</li>
<li><strong>field_names</strong> - list of fields (columns) we want to open (Python list of strings),</li>
<li><strong>where_clause</strong> - SQL query (optional) with which we can limit the opened table only to selected rows.</li>
</ul>
<p>The cursor contains other parameters (shown in the example by three dots), but we will leave them aside here.</p>
<p>The cursor can be browsed directly by a <code>for</code> cycle. The iteration variable goes through the individual lines and always takes a value of a tuple of length <em>n</em>, ie the same length as the the number of open fields. Let's look at an example of opening the "CATEGORY" and "NAME" attributes of the dataset of cities:</p>
<pre><code class="language-python">import arcpy
arcpy.env.workspace = r&quot;C:\my_path\...&quot;
tab = arcpy.da.SearchCursor(&quot;Sidla_body.shp&quot;, [&quot;NAZEV&quot;, &quot;KATEGORIE&quot;])
for r in tab:
    print(r)
del(tab)
</code></pre>
<p>After running the script we get the following output:</p>
<pre><code class="language-console">(u'Praha', 1)
(u'Brno', 2)
(u'Plze\u0148', 2)
(u'Ostrava', 2)
(u'Karlovy Vary', 3)
(u'Zl\xedn', 3)
(u'Chomutov', 3)
(u'Most', 3)
(u'\xdast\xed nad Labem', 3)
(u'Kladno', 3)
(u'Hradec Kr\xe1lov\xe9', 3)
(u'Karvin\xe1', 3)
(u'Pardubice', 3)
(u'Fr\xfddek-M\xedstek', 3)
(u'Hav\xed\u0159ov', 3)
(u'Liberec', 3)
(u'\u010cesk\xe9 Bud\u011bjovice', 3)
(u'Olomouc', 3)
</code></pre>
<p>Because each row is represented by a tuple, we can access the individual items (ie columns) of it using indexes:</p>
<pre><code class="language-python"># -*- coding: cp1250 -*-

import arcpy
arcpy.env.workspace = r&quot;C:\my_path\...&quot;
tab = arcpy.da.SearchCursor(&quot;Sidla_body.shp&quot;, [&quot;NAZEV&quot;, &quot;KATEGORIE&quot;])
for r in tab:
    print(u&quot;City of the category &quot; + str(r[1]) + &quot; is called &quot; + r[0] + &quot;.&quot;)
del(tab)
</code></pre>
<p>The output is:</p>
<pre><code class="language-console">City of the category 1 is called Praha.
City of the category 2 is called Brno.
City of the category 2 is called Plzeň.
City of the category 2 is called Ostrava.
City of the category 3 is called Karlovy Vary.
City of the category 3 is called Zlín.
City of the category 3 is called Chomutov.
City of the category 3 is called Most.
City of the category 3 is called Ústí nad Labem.
City of the category 3 is called Kladno.
City of the category 3 is called Hradec Králové.
City of the category 3 is called Karviná.
City of the category 3 is called Pardubice.
City of the category 3 is called Frýdek-Místek.
City of the category 3 is called Havířov.
City of the category 3 is called Liberec.
City of the category 3 is called České Budějovice.
City of the category 3 is called Olomouc.
</code></pre>
<p>Notice that when opening the table, we have changed the order of the columns compared to how the table appears in ArcGIS. When opening a table with the cursor, we can select any columns in any order, we can even open one column in several copies (which rarely has a good reason). When reading values from a row, the order of the items is exactly the order in which we sorted the columns when creating the cursor.</p>
<p>In the previous example, we did not use the optional parameter <em>where_clause</em>, which we can use to restrict which rows are to be read. For example, if we only wanted to open records for first and second category cities, the code would look like this:</p>
<pre><code class="language-python">import arcpy
arcpy.env.workspace = r&quot;C:\my_path\...&quot;
tab = arcpy.da.SearchCursor(&quot;Sidla_body.shp&quot;, [&quot;NAZEV&quot;], '&quot;KATEGORIE&quot; &lt; 3')
for r in tab:
    print(r[0])
del(tab)
</code></pre>
<p>The result:</p>
<pre><code class="language-console">Praha
Brno
Plzeň
Ostrava
</code></pre>
<p>The <code>for</code> loop is not the only way to browse a table. If we only want to make a single one row move in the table, we can use the cursor method <code>next</code>, which returns the current row and at the same time moves the cursor position to the next row. In this way, for example, it is possible to read the contents of the, say, eighteenth line:</p>
<pre><code class="language-python">import arcpy
arcpy.env.workspace = r&quot;C:\my_path\CR_kraje_sidla_toky&quot;
tab = arcpy.da.SearchCursor(&quot;Sidla_body.shp&quot;, [&quot;NAZEV&quot;, &quot;KATEGORIE&quot;])
for i in range(18):
    r = tab.next()
print(r)
del(tab)
</code></pre>
<pre><code class="language-console">(u'Olomouc', 3)
</code></pre>
<p>When browsing the table, the cursor can only be moved forward. If we get to the end of the table (either by the <code>for</code> loop or the<code>next</code> method), the table can no longer be browsed. To do this, you must recreate the cursor.</p>
<p>Finally, let's look at how to avoid the necessity of explicit deletion of the cursor after use, thanks to the <code>with</code> clause, which you know (in a similar context) from the lesson on text files:</p>
<pre><code class="language-python">import arcpy
arcpy.env.workspace = r&quot;C:\my_path\...&quot;
with arcpy.da.SearchCursor(&quot;Sidla_body.shp&quot;, [&quot;NAZEV&quot;], '&quot;KATEGORIE&quot; &lt; 3') as tab:
    for r in tab:
        print(r[0])
# Here the table is closed and the cursor object deleted
</code></pre>
<blockquote>
<p><strong>Task 2</strong>. Open the table of regions and write down their names and population numbers.</p>
<p><strong>Task 3.</strong> Use the cursor to find the region with the largest number of women over men.</p>
<p><strong>Task 4.</strong> Use the cursor to calculate the shape index (perimeter divided by the area) of each polygon. (Hint: first add the "Area" and "Perimeter" fields to the table and use the <em>Calculate Field</em> tool to calculate their values. Then use the cursor to read the table and divide these values.)</p>
</blockquote>
<h2 id="overwrite-values-in-a-row-with-update-cursor">Overwrite values in a row with <em>Update</em> cursor</h2>
<p>If we want to not only read the contents of the table, but also change them, we use the <em>Update</em> cursor. The syntax is practically the same as for the <em>Search</em> cursor:</p>
<pre><code class="language-python">tab = arcpy.da.UpdateCursor(&quot;Sidla_body.shp&quot;, [&quot;NAZEV&quot;, &quot;KATEGORIE&quot;])
</code></pre>
<p>The difference is what methods the respective cursor has available (in the previous section we used, for example, the <code>next</code> method, which is also available in the <em>Update</em> cursor). A new method, specific for the <em>Update</em> cursor, is the <em>updateRow</em> method, which can be used to replace the line on which the cursor is located with another line. This must be passed to the method in the form of a tuple or list of an appropriate length, while the individual items and their data types must correspond to the open columns.</p>
<p>In the following example, we will change the category of the city of Brno from 2 to 3 (this does not indicate anything bad about this city!):</p>
<pre><code class="language-python">import arcpy
arcpy.env.workspace = r&quot;C:\my_path\CR_kraje_sidla_toky&quot;
tab = arcpy.da.UpdateCursor(&quot;Sidla_body.shp&quot;, [&quot;NAZEV&quot;, &quot;KATEGORIE&quot;], 
                            '&quot;NAZEV&quot; = \'Brno\'')
tab.next()
tab.updateRow((&quot;Brno&quot;, 3))
del(tab)
</code></pre>
<p>Note that we only opened the line with Brno. Nevertheless, we had to use the <code>next</code> method to move the cursor to this first line.</p>
<blockquote>
<p><strong>Task 5.</strong> Add the text field "STATUS" to the table of regions and fill in the value "OK" for those regions where there are deaths than births and "KO" for others.</p>
</blockquote>
<h2 id="delete-a-row">Delete a row</h2>
<p>Another use of the <em>Update</em> cursor is to delete a row. We will now use this and try to erase the city of Brno from the world map for good. However, since we will subsequently want to undo our terrible act and use the <em>Insert</em> cursor to return Brno to the world map, it will be appropriate to save the relevant record somewhere in advance, for example as follows:</p>
<pre><code class="language-python">with arcpy.da.SearchCursor(&quot;Sidla_body.shp&quot;, [&quot;SHAPE@&quot;, &quot;NAZEV&quot;, &quot;KATEGORIE&quot;],
                          '&quot;NAZEV&quot; = \'Brno\'') as tab:
    brno = tab.next()
</code></pre>
<p>It is especially important to keep the contents of the <em>Shape</em> column here, which is done using the name <code>"SHAPE@"</code> (this field and its use will be thoroughly explained in the next lesson). The geometry of the feature (in our case the coordinates of the city of Brno) is stored in this field, which we will need when restoring it.</p>
<p>Now the execution itself:</p>
<pre><code class="language-python">with arcpy.da.UpdateCursor(&quot;Sidla_body.shp&quot;, [&quot;SHAPE@&quot;, &quot;NAZEV&quot;, &quot;KATEGORIE&quot;],
                          '&quot;NAZEV&quot; = \'Brno\'') as tab:
    tab.next()
    tab.deleteRow()
</code></pre>
<p>See the result in the table of cities as well as in the map...</p>
<h2 id="add-a-new-line-with-insert-cursor">Add a new line with <em>Insert</em> cursor</h2>
<p>Now, as we have announced, we have realized the impact of our brutal act. Fortunately, there is an <em>Insert</em> cursor, allowing us to insert a new row into the table. It has a simpler syntax because it does not allow us to filter open rows using an SQL query. The only thing we can influence is which columns we open. A new row is always added to the end of the table (even in the case of such an important city as Brno).</p>
<p>If we work with an attribute table of the vector layer, it is necessary to keep in mind that whenever we add as a new record, it is necessary to feed the <em>Shape</em> field of the table with a corresponding geometry of the added feature. Otherwise, the new line, which should correspond to a feature, will lack a geometry and the whole layer would be damaged and unusable. Fortunately, in the case of Brno, we saved the geometry, so it is not a problem to return it to the table again:</p>
<pre><code class="language-python">with arcpy.da.InsertCursor(&quot;Sidla_body.shp&quot;, [&quot;SHAPE@&quot;, &quot;NAZEV&quot;, &quot;KATEGORIE&quot;]) as tab:
    tab.insertRow(brno)
</code></pre>
<p>We can only hope that you did the whole procedure of deleting and rescuing Brno in one session, ie that you did not restart the console in the meantime. The variable <code>brno</code> would be deleted and the city lost forever...</p>
<h2 id="old-cursor-types">Old cursor types</h2>
<h2 id="summary">Summary</h2>
<h2 id="exercises">Exercises</h2>
<ol>
<li>Write a script that calculates the average shape index for each land cover class for a polygon land cover layer. Solve without cursors.</li>
<li>Solve the previous task with the help of cursors, save the result in a table in the format <code>.csv</code>.</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../about_me/" class="btn btn-neutral float-right" title="About me...">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Lesson%2013%20Attribute%20Operations/" class="btn btn-neutral" title="Lesson 13: Attribute Operations"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/vojta-bartak/Python-for-ArcGIS-CZU-EN/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../Lesson%2013%20Attribute%20Operations/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../about_me/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
